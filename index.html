<html>
    <head>
        <title>Julian's Calculator</title>
        <link rel="stylesheet" href="style.css">

    </head>
    <body>
        <div id="container">
            <div id="calculatorContainer">
                <div id="displayArea">
                    <div id="previousPreviousNumberArea">
                        <div id="previousPreviousNumber">
                            10+20

                        </div>
                    </div>
                    <div id="previousNumberArea">
                        <div id="previousNumber">
                            30+5
                        </div> 
                    </div>
                    <div id="currentNumberArea">
                        <div id="currentNumber">
                            
                        </div>
                    </div>

                    
                </div>

                <div class="buttonArea">
                    <button id="clearButton">Clear</button>
                    <button id="backspaceButton">Backspace</button>
                    <button id="squareButton">x^2</button>
                    <button class="normal" data-value=" * ">*</button>
                    <button class="normal" data-value="7" >7</button>
                    <button class="normal" data-value="8" >8</button>
                    <button class="normal" data-value="9" >9</button>
                    <button class="normal" data-value=" / " >/</button>
                    <button class="normal" data-value="4" >4</button>
                    <button class="normal" data-value="5" >5</button>
                    <button class="normal" data-value="6" >6</button>
                    <button class="normal" data-value=" + " >+</button>
                    <button class="normal" data-value="1" >1</button>
                    <button class="normal" data-value="2" >2</button>
                    <button class="normal" data-value="3" >3</button>
                    <button class="normal" data-value=" - " >-</button>
                    <button class="normal" data-value="0" >0</button>
                    <button class="normal" data-value="." >.</button>
                    <button data-value="" >+/-</button>
                    <button id="equalsButton" >=</button>
                </div>

            </div>

        </div>
        <script>
            let currentNumber;
            let previousNumber;
            let previousPreviousNumber;

            let lastCharWasOperator = false;
            let decimalInputted = false;

            let hasPreviousEquation = false;
            let previousEquationValue = "";

            let currentEquation = "";

            function changePolarity(){

            }


            function appendValueToEquation(e){
                let value = e.target.getAttribute("data-value");

                operators = ["+", "-", "*", "/"];

                if(currentEquation == "" && operators.includes(value) && hasPreviousEquation){
                    currentEquation += previousEquationValue;
                    currentEquation += value;
                    return;
                }

                if(value == "."){
                    decimalInputted = true;
                }

                if(operators.includes(value)){
                    lastCharWasOperator = true;
                }

                if(!operators.includes(value)){
                    lastCharWasOperator = false;
                    decimalInputted = false;
                }

                if(decimalInputted && value == "."){
                    alert("Error: You can't enter two decimals");
                    return;
                }

                if(lastCharWasOperator && operators.includes(value)){
                    alert("Error: You can't enter two operators in a row");
                    return;
                }

                currentEquation += value;
            }

            let backspaceButtonReference = document.querySelector("#backspaceButton");
            backspaceButtonReference.addEventListener("click", backSpace);

            function backSpace(){
                if(currentEquation.charAt(currentEquation.length - 1) == " "){
                    temp = currentEquation.slice(0, -2);
                    currentEquation = temp;
                }
                else{
                    temp = currentEquation.slice(0, -1);
                    currentEquation = temp;   
                }
            }

            let clearButtonReference = document.querySelector("#clearButton");
            clearButtonReference.addEventListener("click", clear);

            function clear(){
                currentEquation = "";
            }

            function square(){
                return evaluate(currentEquation) * evaluate(currentEquation);
            }

            function evaluate(equation){
                let equationArr = equation.split(" ");

                // equationArr.pop();

                //if last element in array is an operator
                if(isNaN(equationArr[equationArr.length-1])){
                    invalidEquation();
                }

                let totalValue = equationArr[0];
                let currentNumber;
                let currentOperator;

                for(i = 1; i < equationArr.length; i++){
                    // console.log("ITERATION " + i);
                    // console.log(totalValue);
                    // console.log(currentOperator);
                    // console.log(currentNumber);
                    
                    if(isNaN(equationArr[i])){
                        if(isNaN(equationArr[i - 1])){
                            invalidEquation();
                            return;
                        }

                        if(currentNumber && currentOperator){
                            // console.log("operating" + currentOperator);Â 
                            totalValue = operatorEvaluation(currentOperator, currentNumber, totalValue);
                        }
                        currentOperator = equationArr[i];

                    }
                    else{
                        // console.log("assigning");
                        currentNumber = Number(equationArr[i]);
                    }
                }

                totalValue = operatorEvaluation(currentOperator, currentNumber, totalValue);

                hasPreviousEquation = true;

                previousEquationValue = totalValue;

                return totalValue;

            }

            function operatorEvaluation(operator, currentNumber, totalValue){
                // console.log("current operation: " + totalValue + " " + operator + " " + currentNumber);
                newVal = Number(totalValue);

                if(operator == "+"){
                    newVal += currentNumber;
                }
                if(operator == "-"){
                    newVal -= currentNumber;
                }
                if(operator == "*"){
                    newVal *= currentNumber;
                }
                if(operator == "/"){
                    if(currentNumber == 0){
                        divideByZeroError();
                        return;
                    } 
                    newVal /= currentNumber;
                }

                return newVal;
            }

            function invalidEquation(){
                alert("That equation is invalid");
                clear();
            }

            function divideByZeroError(){
                alert("Divide by zero error");
                clear();
            }



            //adding event listeners to button area
            let buttonArea = document.querySelector(".buttonArea").children;
            for(i = 0; i < buttonArea.length; i++){
                if(buttonArea[i].classList.contains("normal")){
                    buttonArea[i].addEventListener("click", appendValueToEquation);
                }
            }

            let button = document.querySelector("#equalsButton");
            button.addEventListener("click", evaluateEq);



            let currentNumberReference = document.querySelector("#currentNumber");
            let buttonAreaReference = document.querySelector(".buttonArea");
            buttonAreaReference.addEventListener("click", updateNumberField);

            function updateNumberField(){
                currentNumberReference.textContent = currentEquation;
            }

            function evaluateEq(){
                previousEquationValue = evaluate(currentEquation);
                currentEquation = evaluate(currentEquation);
            }
        </script>

    </body>
</html>